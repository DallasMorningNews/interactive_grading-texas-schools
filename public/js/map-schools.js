!function(){function e(e){return e.trim().toLowerCase()}function t(e){n="grade"+$("#categoryIndex").val(),p.addSource("dataPoints",{type:"geojson",data:e,cluster:!1}),p.addLayer({id:"campuses",type:"circle",source:"dataPoints",paint:{"circle-radius":{base:2,stops:[[9,3],[18,150]]},"circle-color":{property:n,type:"categorical",stops:d}},filter:["==","$type","Point"]}),p.addLayer({id:"districts",type:"fill",source:"dataPoints",paint:{"fill-color":{property:n,type:"categorical",stops:d},"fill-opacity":.4,"fill-outline-color":"#636363"},filter:["==","$type","Polygon"],layout:{visibility:"none"}}),p.addControl(new mapboxgl.NavigationControl),p.dragRotate.disable(),p.touchZoomRotate.disableRotation();var t=new mapboxgl.Popup({closeButton:!1,closeOnClick:!1});p.on("mousemove",function(e){var a=p.queryRenderedFeatures(e.point,{layers:["campuses","districts"]});if(p.getCanvas().style.cursor=a.length?"pointer":"",!a.length)return void t.remove();var r,o=a[0];r="1"==$("#categoryIndex").val()?"I":"2"==$("#categoryIndex").val()?"II":"3"==$("#categoryIndex").val()?"III":"IV",t.setLngLat(p.unproject(e.point)).setHTML("<p class='campus'>"+o.properties.schoolname+"</p><p>"+o.properties.distname+"</p><p>Category "+r+": "+o.properties[n]+"</p>").addTo(p)})}function a(e){n="grade"+$("#categoryIndex").val(),s=$("#campusOrDistrict").val(),c="campuses"==s?"Point":"Polygon";var t=$("#grade").val();if("all"==e)"all"==t?p.setFilter(s,["all",["has","gid"],["==","$type",c]]):r(t),l.column(2).search("").draw();else{var a;a="all"==t?_.filter(i.features,function(t){return t.properties.type==e}):_.filter(i.features,function(a){return a.properties.type==e&&a.properties[n]==t}),p.setFilter(s,["all",["in","gid"].concat(a.map(function(e){return e.properties.gid})),["==","$type",c]]),l.column(2).search(e).draw()}}function r(e){var t=$("#schoolType").val(),a=$("#categoryIndex").val();s=$("#campusOrDistrict").val(),c="campuses"==s?"Point":"Polygon",n="grade"+a;var r,o=2+parseInt(a),d=e;r="all"==t?_.filter(i.features,function(e){return e.properties[n]==d}):_.filter(i.features,function(e){return e.properties.type==t&&e.properties[n]==d}),p.setFilter(s,["all",["in","gid"].concat(r.map(function(e){return e.properties.gid})),["==","$type",c]]),l.column(o).search(d).draw()}function o(){$("body").dnLoader("remove"),t(i);var o;$("#schoolType").change(function(){a(this.value)}),$("#grade").change(function(){o=2+parseInt($("#categoryIndex").val()),"all"==this.value?(a($("#schoolType").val()),l.column(o).search("").draw()):r(this.value)}),$("#categoryIndex").change(function(){n="grade"+this.value,s=$("#campusOrDistrict").val();var e="campuses"==s?"circle-color":"fill-color";p.setPaintProperty(s,e,{property:n,type:"categorical",stops:d}),l.search("").columns().search("").draw(),a($("#schoolType").val())}),$("#clearButton").click(function(){s=$("#campusOrDistrict").val(),c="campuses"==s?"Point":"Polygon",p.setFilter(s,["all",["has","gid"],["==","$type",c]]),l.search("").columns().search("").draw(),$("#categoryIndex").val("1"),$("#schoolType").val("all"),$("#grade").val("all")}),$("input[type=search]").keyup(function(t){$("#categoryIndex").val("1"),$("#schoolType").val("all"),$("#grade").val("all"),s=$("#campusOrDistrict").val(),c="campuses"==s?"Point":"Polygon";var a=e(t.target.value),r=_.filter(i.features,function(t){var r=e(t.properties.schoolname),o=e(t.properties.distname);return(r.indexOf(a)>-1||o.indexOf(a)>-1)&&"-"!==r});p.setFilter(s,["all",["in","gid"].concat(r.map(function(e){return e.properties.gid})),["==","$type",c]])}),$("#campusOrDistrict").change(function(){$("#categoryIndex").val("1"),$("#schoolType").val("all"),$("#grade").val("all");var e=this.value,t="campuses"==e?"districts":"campuses";p.setLayoutProperty(t,"visibility","none"),p.setLayoutProperty(e,"visibility","visible"),"districts"==e?$("#schoolType").prop("disabled",!0):$("#schoolType").prop("disabled",!1)})}var i,l,n,s,c,p=new mapboxgl.Map({container:"map",center:[-96.9785,32.8924],zoom:9,style:"//maps.dallasnews.com/styles.json"}),d=[["A","#4575b4"],["B","#74add1"],["C","#fdae61"],["D","#f46d43"],["F","#d73027"],["-","#636363"]],u=d3.scaleOrdinal().domain(["A","B","C","D","F"]).range(["#4575b4","#74add1","#fdae61","#f46d43","#d73027"]),g=_.after(2,o);p.on("load",g),$.getJSON("assets/accountability_ratings.json",function(e){i=JSON.parse(JSON.stringify(e));var t=_.filter(i.features,function(e){return null!==e.properties.gid});i.features=t,g(),l=$("#schoolTable").DataTable({data:e.features,columns:[{data:"properties.schoolname"},{data:"properties.distname"},{data:"properties.type"},{data:"properties.grade1"},{data:"properties.grade2"},{data:"properties.grade3"},{data:"properties.grade4"},{data:"properties.rating"},{data:"properties.lowinc"}],scrollX:!0,order:[[1,"asc"],[0,"asc"]]})}),$("#schoolInfo").qtip({style:{classes:"qtip-default qtip-light qtip-shadow"},content:{text:"E = Elementary<br/>M = Middle School<br/>H = High School<br/>B = Blended",title:"School Level",button:!0},position:{my:"top center",at:"bottom center",target:$("#schoolInfo")}}),$("#ratingInfo").qtip({style:{classes:"qtip-light qtip-shadow"},content:{text:"Actual rating given by state.<br/>M = Met Standard<br/>A = Met Alternative Standard<br/>I = Improvement Required<br/>Q/X/Z = Not Rated",title:"2016 Rating",button:!0},position:{my:"top right",at:"bottom center",target:$("#ratingInfo")}}),$("#povertyInfo").qtip({style:{classes:"qtip-light qtip-shadow"},content:{text:"The percentage of students who are economically disadvantaged.",title:"Percent Low Income",button:!0},position:{my:"top right",at:"bottom center",target:$("#povertyInfo")}});var y=d3.select("#legendScale");y.append("g").attr("class","legendLinear").attr("transform","translate(5,5)");var v=d3.legendColor().shapeWidth(30).orient("horizontal").scale(u);y.select(".legendLinear").call(v)}();
//# sourceMappingURL=map-schools.js.map
